import{m as U,n as B,v as N,u as m,o as s,c as o,p as M,q as V,s as R,x as C,y as $,r as x,z as A,g as D,a as r,F as _,A as y,B as E,b as k,w as P,C as q,t as w,d as z,D as F}from"./Bn-8mWEk.js";import{u as L,c as O,_ as H}from"./Cf1iGbdL.js";const G=U({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(i,{emit:l}){const c=i,a=L(c,"modelValue",l,{passive:!0,defaultValue:c.defaultValue});return(v,n)=>B((s(),o("input",{"onUpdate:modelValue":n[0]||(n[0]=u=>V(a)?a.value=u:null),class:M(m(O)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c.class))},null,2)),[[N,m(a)]])}}),J=R("chat",{state:()=>({messages:[]}),actions:{addMessage(i,l){typeof l=="object"&&l!==null?this.messages.push({role:i,...l}):this.messages.push({role:i,text:l})},clearMessages(){this.messages=[]}},persist:!0});function K(){const i=C();return{sendMessage:async(c,t)=>{try{return await $fetch(`${i.public.apiBase}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:{user_id:c,input:t}})}catch(a){return console.error("Chat API error:",a),{response:"Error: Could not get response."}}}}}const Q={class:"flex flex-col p-3 h-screen w-full bg-black text-white"},W={class:"flex flex-col h-full border-2 border-white rounded-lg bg-black"},X={class:"p-3 text-lg border-2 border-white font-bold rounded-lg text-white max-w-full break-words whitespace-pre-wrap bg-gray-950"},Y={key:0,class:"mb-2"},Z={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ee={class:"w-full aspect-square mb-2"},te=["src"],se={class:"text-lg font-bold text-white mb-2 text-center max-w-lg line-clamp-2"},oe=["href"],re={key:1,disabled:"",class:"bg-black text-white border font-bold py-2 px-4 rounded w-full text-center cursor-not-allowed truncate"},le={key:1},ae={class:"border-t-2 border-white p-4 bg-black rounded-b-lg"},ie={__name:"chat",setup(i){const c=`${C().public.baseURL}placeholder_large_dark.jpg`,t=J(),{messages:a}=$(t),{sendMessage:v}=K(),n=x(""),u=x(null),h=x("");function I(){return"user-"+Math.random().toString(36).slice(2,11)}A(()=>{const p=localStorage.getItem("chatUserId");h.value=p||I(),localStorage.setItem("chatUserId",h.value)}),D(a,async()=>{await F(),u.value&&(u.value.scrollTop=u.value.scrollHeight)},{deep:!0});async function S(){const p=n.value.trim();if(!p)return;t.addMessage("user",p),n.value="",t.addMessage("bot","Typing...");const e=await v(h.value,p);t.messages.pop();const f=e&&e.response&&e.response.trim().length>0,g=e&&e.items&&Object.keys(e.items).length>0;f&&g?t.addMessage("bot",{text:e.response,items:e.items}):f?t.addMessage("bot",e.response):g?t.addMessage("bot",{items:e.items}):t.addMessage("bot","Error: Could not get a response.")}return(p,e)=>{const f=G,g=H;return s(),o("div",Q,[r("div",W,[r("div",{ref_key:"chatContainer",ref:u,class:"flex-1 overflow-y-auto space-y-4 bg-black rounded-t-lg p-3"},[(s(!0),o(_,null,y(m(t).messages,(d,T)=>(s(),o("div",{key:T,class:M(["flex p-3",d.role==="user"?"justify-end":"justify-start"])},[r("div",X,[d.items?(s(),o(_,{key:0},[d.text?(s(),o("div",Y,[r("p",null,w(d.text),1)])):q("",!0),r("div",Z,[(s(!0),o(_,null,y(d.items,(b,j)=>(s(),o("div",{key:j,class:"flex border-2 border-white bg-black p-4 rounded-lg flex-col items-center"},[r("div",ee,[r("img",{src:b.image_link||c,alt:"Product Image",class:"w-full h-full object-cover rounded"},null,8,te)]),r("div",se,w(b.row_index),1),b.website_link?(s(),o("a",{key:0,href:b.website_link,target:"_blank",class:"bg-white hover:bg-gray-100 text-black font-bold py-2 px-4 rounded w-full text-center"}," Buy ",8,oe)):(s(),o("button",re," Not Available "))]))),128))])],64)):(s(),o("p",le,w(d.text),1))])],2))),128))],512),r("div",ae,[r("form",{onSubmit:E(S,["prevent"]),class:"flex"},[k(f,{modelValue:m(n),"onUpdate:modelValue":e[0]||(e[0]=d=>V(n)?n.value=d:null),placeholder:"Type your message...",class:"flex-1 mr-2 bg-black text-white border-2 border-white placeholder-white rounded-lg text-2xl p-2 placeholder:text-2xl h-12 leading-12"},null,8,["modelValue"]),k(g,{type:"submit",variant:"default",class:"border-white rounded-lg p-2 h-12 flex items-center justify-center text-2xl"},{default:P(()=>e[1]||(e[1]=[z(" Send ")])),_:1})],32)])])])}}};export{ie as default};

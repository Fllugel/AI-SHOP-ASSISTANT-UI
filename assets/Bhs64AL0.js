import{m as S,n as T,v as j,u as m,o,c as r,p as k,q as M,s as B,x as U,y as N,r as x,z as R,g as $,a as l,F as _,A as v,B as A,b as y,w as D,C as E,t as w,d as P,D as q}from"./8MEeAvrj.js";import{u as z,c as F,_ as O}from"./DenGtkEb.js";const H=S({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(n,{emit:e}){const d=n,s=z(d,"modelValue",e,{passive:!0,defaultValue:d.defaultValue});return(u,i)=>T((o(),r("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>M(s)?s.value=h:null),class:k(m(F)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d.class))},null,2)),[[j,m(s)]])}}),L=B("chat",{state:()=>({messages:[]}),actions:{addMessage(n,e){typeof e=="object"&&e!==null?this.messages.push({role:n,...e}):this.messages.push({role:n,text:e})},clearMessages(){this.messages=[]}},persist:!0});function G(){const n=U();return{sendMessage:async(d,p)=>{try{return await $fetch(`${n.public.apiBase}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:{user_id:d,input:p}})}catch(s){return console.error("Chat API error:",s),{response:"Error: Could not get response."}}}}}const J={class:"flex flex-col p-3 h-screen w-full bg-black text-white"},K={class:"flex flex-col h-full border-2 border-white rounded-lg bg-black"},Q={class:"p-3 text-lg border-2 border-white font-bold rounded-lg text-white max-w-full break-words whitespace-pre-wrap bg-gray-950"},W={key:0,class:"mb-2"},X={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Y={class:"w-full aspect-square mb-2"},Z=["src"],ee={class:"text-lg font-bold text-white mb-2 text-center max-w-lg line-clamp-2"},te=["href"],se={key:1,disabled:"",class:"bg-black text-white border font-bold py-2 px-4 rounded w-full text-center cursor-not-allowed truncate"},oe={key:1},re={class:"border-t-2 border-white p-4 bg-black rounded-b-lg"},le="/placeholder_large_dark.jpg",de={__name:"chat",setup(n){const e=L(),{messages:d}=N(e),{sendMessage:p}=G(),s=x(""),u=x(null),i=x("");function h(){return"user-"+Math.random().toString(36).slice(2,11)}R(()=>{const c=localStorage.getItem("chatUserId");i.value=c||h(),localStorage.setItem("chatUserId",i.value)}),$(d,async()=>{await q(),u.value&&(u.value.scrollTop=u.value.scrollHeight)},{deep:!0});async function V(){const c=s.value.trim();if(!c)return;e.addMessage("user",c),s.value="",e.addMessage("bot","Typing...");const t=await p(i.value,c);e.messages.pop();const f=t&&t.response&&t.response.trim().length>0,g=t&&t.items&&Object.keys(t.items).length>0;f&&g?e.addMessage("bot",{text:t.response,items:t.items}):f?e.addMessage("bot",t.response):g?e.addMessage("bot",{items:t.items}):e.addMessage("bot","Error: Could not get a response.")}return(c,t)=>{const f=H,g=O;return o(),r("div",J,[l("div",K,[l("div",{ref_key:"chatContainer",ref:u,class:"flex-1 overflow-y-auto space-y-4 bg-black rounded-t-lg p-3"},[(o(!0),r(_,null,v(m(e).messages,(a,C)=>(o(),r("div",{key:C,class:k(["flex p-3",a.role==="user"?"justify-end":"justify-start"])},[l("div",Q,[a.items?(o(),r(_,{key:0},[a.text?(o(),r("div",W,[l("p",null,w(a.text),1)])):E("",!0),l("div",X,[(o(!0),r(_,null,v(a.items,(b,I)=>(o(),r("div",{key:I,class:"flex border-2 border-white bg-black p-4 rounded-lg flex-col items-center"},[l("div",Y,[l("img",{src:b.image_link||le,alt:"Product Image",class:"w-full h-full object-cover rounded"},null,8,Z)]),l("div",ee,w(b.row_index),1),b.website_link?(o(),r("a",{key:0,href:b.website_link,target:"_blank",class:"bg-white hover:bg-gray-100 text-black font-bold py-2 px-4 rounded w-full text-center"}," Buy ",8,te)):(o(),r("button",se," Not Available "))]))),128))])],64)):(o(),r("p",oe,w(a.text),1))])],2))),128))],512),l("div",re,[l("form",{onSubmit:A(V,["prevent"]),class:"flex"},[y(f,{modelValue:m(s),"onUpdate:modelValue":t[0]||(t[0]=a=>M(s)?s.value=a:null),placeholder:"Type your message...",class:"flex-1 mr-2 bg-black text-white border-2 border-white placeholder-white rounded-lg text-2xl p-2 placeholder:text-2xl h-12 leading-12"},null,8,["modelValue"]),y(g,{type:"submit",variant:"default",class:"border-white rounded-lg p-2 h-12 flex items-center justify-center text-2xl"},{default:D(()=>t[1]||(t[1]=[P(" Send ")])),_:1})],32)])])])}}};export{de as default};

import{m as V,n as M,v as k,u as g,o as c,c as p,p as b,q as x,s as C,r as f,x as I,y as S,z as T,g as B,a as u,F as U,A as j,B as R,b as h,w as $,t as E,d as N,C as z}from"./CaXnpHW3.js";import{u as A,c as D,_ as F}from"./xJHROGki.js";const P=V({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(r,{emit:e}){const l=r,s=A(l,"modelValue",e,{passive:!0,defaultValue:l.defaultValue});return(t,o)=>M((c(),p("input",{"onUpdate:modelValue":o[0]||(o[0]=m=>x(s)?s.value=m:null),class:b(g(D)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l.class))},null,2)),[[k,g(s)]])}}),q=C("chat",{state:()=>({messages:[]}),actions:{addMessage(r,e){this.messages.push({role:r,text:e})},clearMessages(){this.messages=[]}},persist:!0});function H(){const r=I(),e=f([]);return{messages:e,sendMessage:async(d,s)=>{try{e.value.push({role:"user",text:s});const t=e.value.length;e.value.push({role:"bot",text:"Waiting for response..."});const o=await $fetch(`${r.public.apiBase}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:{user_id:d,input:s}});return e.value[t]={role:"bot",text:o.response},o.response}catch(t){console.error("Chat API error:",t),e.value.push({role:"bot",text:"Error: Could not get response."})}}}}const L={class:"flex flex-col p-3 h-screen w-full bg-black text-white"},O={class:"flex flex-col h-full border-2 border-white rounded-lg bg-black"},W={class:"p-3 text-lg border-2 border-white font-bold rounded-lg text-white max-w-full break-words whitespace-pre-wrap bg-gray-950"},G={class:"border-t-2 border-white p-4 bg-black rounded-b-lg"},Q={__name:"chat",setup(r){const e=q(),{messages:l}=S(e),{sendMessage:d}=H(),s=f(""),t=f(null),o=f("");function m(){return"user-"+Math.random().toString(36).slice(2,11)}T(()=>{const n=localStorage.getItem("chatUserId");o.value=n||m(),localStorage.setItem("chatUserId",o.value)}),B(l,async()=>{await z(),t.value&&(t.value.scrollTop=t.value.scrollHeight)},{deep:!0});async function v(){const n=s.value.trim();if(!n)return;e.addMessage("user",n),s.value="",e.addMessage("bot","Typing...");const a=await d(o.value,n);a?(e.messages.pop(),e.addMessage("bot",a)):(e.messages.pop(),e.addMessage("bot","Error: Could not get a response."))}return(n,a)=>{const _=P,w=F;return c(),p("div",L,[u("div",O,[u("div",{ref_key:"chatContainer",ref:t,class:"flex-1 overflow-y-auto space-y-4 bg-black rounded-t-lg p-3"},[(c(!0),p(U,null,j(g(e).messages,(i,y)=>(c(),p("div",{key:y,class:b(["flex p-3",i.role==="user"?"justify-end":"justify-start"])},[u("div",W,[u("p",null,E(i.text),1)])],2))),128))],512),u("div",G,[u("form",{onSubmit:R(v,["prevent"]),class:"flex"},[h(_,{modelValue:g(s),"onUpdate:modelValue":a[0]||(a[0]=i=>x(s)?s.value=i:null),placeholder:"Type your message...",class:"flex-1 mr-2 bg-black text-white border-2 border-white placeholder-white rounded-lg text-2xl p-2 placeholder:text-2xl h-12 leading-12"},null,8,["modelValue"]),h(w,{type:"submit",variant:"default",class:"border-white rounded-lg p-2 h-12 flex items-center justify-center text-2xl"},{default:$(()=>a[1]||(a[1]=[N(" Send ")])),_:1})],32)])])])}}};export{Q as default};
